<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Morphing Survey</title>
<style>
  body { text-align: center; font-family: sans-serif; }
  img { width: 350px; height: auto; }
</style>
</head>
<body>

<h2>どの形がいちばん好みですか？</h2>

<p>スライダーを動かして、好きな形を選んでください</p>

<img id="morphImage" src="morph_frames/morph_000.png">

<br><br>

<input type="range" id="slider" min="0" max="100" value="0">

<p>選択中： <span id="alphaValue">0</span>%</p>

<button onclick="submitAnswer()">回答を送信</button>

<script>
const slider = document.getElementById("slider");
const img = document.getElementById("morphImage");
const alphaText = document.getElementById("alphaValue");

// スライダー動作
slider.oninput = () => {
    alphaText.textContent = slider.value;
    img.src = `morph_frames/morph_${String(slider.value).padStart(3, "0")}.png`;
};


// ===============================
// ★ CORS 完全回避版 submitAnswer()
// ===============================
function submitAnswer() {
    const alpha = slider.value;

    // FormData（OPTIONS を発生させない仕組み）
    const formData = new FormData();
    formData.append("alpha", alpha);

    fetch("https://script.google.com/macros/s/AKfycbx6cwDS9IMLQX0JOE-dBDD7FizSu_kC3wTD9VEYouuAY6LC6MdUWrGJsnKKdGdsMWFbuA/exec, {
        method: "POST",
        body: formData
        // ⚠ Content-Type を絶対に指定しないこと
        // → 指定すると OPTIONS が発生して CORS で死ぬ
    })
    .then(r => r.text())
    .then(text => {
        alert("回答ありがとうございました！");
        console.log("Server response:", text);
    })
    .catch(err => {
        console.error("Error:", err);
        alert("送信に失敗しました");
    });
}
</script>

</body>
</html>
